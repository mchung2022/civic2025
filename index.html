<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>äººæ¬Šå®ˆè­·è€… - Human Rights Defenders</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            color: #333;
        }

        .game-container {
            max-width: 1200px;
            width: 95%;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 20px;
            position: relative;
            overflow: hidden;
        }

        .game-header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            border-radius: 15px;
            color: white;
        }

        .game-header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }

        .game-header p {
            font-size: 1.2em;
            opacity: 0.9;
        }

        .game-board {
            display: grid;
            grid-template-columns: repeat(8, 1fr);
            gap: 8px;
            margin: 20px 0;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 15px;
            box-shadow: inset 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .board-cell {
            aspect-ratio: 1;
            background: linear-gradient(135deg, #ffeaa7 0%, #fab1a0 100%);
            border: 2px solid #ddd;
            border-radius: 10px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            font-size: 0.8em;
            text-align: center;
            padding: 5px;
        }

        .board-cell:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
        }

        .board-cell.start {
            background: linear-gradient(135deg, #00b894 0%, #00cec9 100%);
            color: white;
        }

        .board-cell.challenge {
            background: linear-gradient(135deg, #e17055 0%, #fdcb6e 100%);
        }

        .board-cell.opportunity {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
        }

        .board-cell.goal {
            background: linear-gradient(135deg, #fd79a8 0%, #fdcb6e 100%);
        }

        .player-info {
            display: flex;
            justify-content: space-between;
            margin: 20px 0;
            gap: 15px;
        }

        .player-card {
            flex: 1;
            background: white;
            border-radius: 15px;
            padding: 20px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #6c5ce7;
        }

        .player-card.active {
            border-left: 5px solid #e17055;
            background: #fff5f5;
        }

        .player-card h3 {
            color: #6c5ce7;
            margin-bottom: 10px;
        }

        .stats {
            display: flex;
            justify-content: space-between;
            margin: 10px 0;
        }

        .stat {
            text-align: center;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
            flex: 1;
            margin: 0 5px;
        }

        .control-panel {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1em;
            font-weight: bold;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .event-card {
            background: white;
            border-radius: 15px;
            padding: 20px;
            margin: 15px 0;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            border-left: 5px solid #e17055;
            display: none;
        }

        .event-card.active {
            display: block;
            animation: slideIn 0.5s ease;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .dice {
            font-size: 2em;
            margin: 0 10px;
            animation: spin 0.5s ease;
        }

        @keyframes spin {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .player-piece {
            position: absolute;
            top: 5px;
            right: 5px;
            width: 15px;
            height: 15px;
            border-radius: 50%;
            border: 2px solid white;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.3);
            z-index: 10;
        }

        .player1 { background: #e74c3c; }
        .player2 { background: #3498db; }

        .choice-buttons {
            display: flex;
            gap: 10px;
            margin-top: 15px;
            flex-wrap: wrap;
        }

        .choice-btn {
            flex: 1;
            min-width: 150px;
            padding: 10px;
            background: #74b9ff;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .choice-btn:hover {
            background: #0984e3;
            transform: translateY(-2px);
        }

        .achievement-badge {
            display: inline-block;
            background: #00b894;
            color: white;
            padding: 5px 10px;
            border-radius: 15px;
            font-size: 0.8em;
            margin: 2px;
        }

        .game-log {
            background: white;
            border-radius: 10px;
            padding: 15px;
            margin: 10px 0;
            max-height: 200px;
            overflow-y: auto;
            border: 1px solid #ddd;
        }

        .log-entry {
            padding: 5px 0;
            border-bottom: 1px solid #eee;
            font-size: 0.9em;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 30px;
            border-radius: 15px;
            width: 80%;
            max-width: 600px;
            text-align: center;
            animation: modalAppear 0.3s ease;
        }

        @keyframes modalAppear {
            from {
                opacity: 0;
                transform: scale(0.8);
            }
            to {
                opacity: 1;
                transform: scale(1);
            }
        }

        .close {
            color: #aaa;
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: black;
        }

        .current-turn {
            background: #e8f5e8;
            padding: 10px;
            border-radius: 10px;
            text-align: center;
            margin: 10px 0;
            font-weight: bold;
            color: #2d5a2d;
        }
    </style>
</head>
<body>
    <div class="game-container">
        <div class="game-header">
            <h1>ğŸŒ äººæ¬Šå®ˆè­·è€…</h1>
            <p>Human Rights Defenders - é€ééŠæˆ²å­¸ç¿’äººæ¬Šåƒ¹å€¼</p>
        </div>

        <div class="current-turn" id="currentTurn">
            ç›®å‰è¼ªåˆ°ï¼šç©å®¶1 (è¨˜è€…)
        </div>

        <div class="player-info">
            <div class="player-card active" id="player1Card">
                <h3>ğŸ‘¤ ç©å®¶1 - è¨˜è€…</h3>
                <div class="stats">
                    <div class="stat">
                        <strong>å½±éŸ¿åŠ›</strong><br>
                        <span id="player1-influence">30</span>
                    </div>
                    <div class="stat">
                        <strong>è³‡æº</strong><br>
                        <span id="player1-resources">20</span>
                    </div>
                    <div class="stat">
                        <strong>è²æœ›</strong><br>
                        <span id="player1-reputation">25</span>
                    </div>
                </div>
                <div id="player1-achievements"></div>
            </div>
            
            <div class="player-card" id="player2Card">
                <h3>âš–ï¸ ç©å®¶2 - å¾‹å¸«</h3>
                <div class="stats">
                    <div class="stat">
                        <strong>å½±éŸ¿åŠ›</strong><br>
                        <span id="player2-influence">25</span>
                    </div>
                    <div class="stat">
                        <strong>è³‡æº</strong><br>
                        <span id="player2-resources">25</span>
                    </div>
                    <div class="stat">
                        <strong>è²æœ›</strong><br>
                        <span id="player2-reputation">20</span>
                    </div>
                </div>
                <div id="player2-achievements"></div>
            </div>
        </div>

        <div class="game-board" id="gameBoard">
            <!-- éŠæˆ²æ£‹ç›¤å°‡ç”±JavaScriptç”Ÿæˆ -->
        </div>

        <div class="control-panel">
            <button class="btn btn-primary" onclick="rollDice()">ğŸ² æ“²éª°å­</button>
            <button class="btn btn-primary" onclick="showRules()">ğŸ“‹ éŠæˆ²è¦å‰‡</button>
            <button class="btn btn-primary" onclick="resetGame()">ğŸ”„ é‡æ–°é–‹å§‹</button>
        </div>

        <div class="event-card" id="eventCard">
            <h3 id="eventTitle">ğŸ¯ æº–å‚™é–‹å§‹</h3>
            <p id="eventDescription">é»æ“Šæ“²éª°å­é–‹å§‹ä½ çš„äººæ¬Šå®ˆè­·ä¹‹æ—…ï¼</p>
            <div class="choice-buttons" id="choiceButtons" style="display: none;">
                <!-- é¸æ“‡æŒ‰éˆ•å°‡ç”±JavaScriptå‹•æ…‹ç”Ÿæˆ -->
            </div>
        </div>

        <div class="game-log" id="gameLog">
            <div class="log-entry">ğŸ® éŠæˆ²é–‹å§‹ï¼æ­¡è¿ä¾†åˆ°äººæ¬Šå®ˆè­·è€…çš„ä¸–ç•Œ</div>
        </div>
    </div>

    <!-- è¦å‰‡èªªæ˜æ¨¡æ…‹çª— -->
    <div id="rulesModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeModal()">&times;</span>
            <h2>ğŸ¯ éŠæˆ²è¦å‰‡</h2>
            <div style="text-align: left; margin: 20px 0;">
                <h3>ğŸ® éŠæˆ²ç›®æ¨™</h3>
                <p>ä½œç‚ºäººæ¬Šå®ˆè­·è€…ï¼Œä½ çš„ç›®æ¨™æ˜¯é€šéå„ç¨®è¡Œå‹•å’Œæ±ºç­–ä¾†ç¶­è­·äººæ¬Šï¼Œç´¯ç©å½±éŸ¿åŠ›ã€è³‡æºå’Œè²æœ›ã€‚</p>
                
                <h3>ğŸ² éŠæˆ²æµç¨‹</h3>
                <ol>
                    <li>æ“²éª°å­ç§»å‹•æ£‹å­</li>
                    <li>æ ¹æ“šè½åœ°ä½ç½®è§¸ç™¼ä¸åŒäº‹ä»¶</li>
                    <li>é¢å°äººæ¬ŠæŒ‘æˆ°ä¸¦åšå‡ºé¸æ“‡</li>
                    <li>ç²å¾—ç›¸æ‡‰çš„çå‹µæˆ–æ‰¿æ“”å¾Œæœ</li>
                    <li>ç´¯ç©æˆå°±ï¼Œæˆç‚ºçœŸæ­£çš„äººæ¬Šå®ˆè­·è€…</li>
                </ol>
                
                <h3>ğŸ† ç²å‹æ¢ä»¶</h3>
                <p>é¦–å…ˆé”åˆ°ä»¥ä¸‹ä»»ä¸€æ¢ä»¶çš„ç©å®¶ç²å‹ï¼š</p>
                <ul>
                    <li>å½±éŸ¿åŠ›é”åˆ° 120 é»</li>
                    <li>ç²å¾— 5 å€‹æˆå°±å¾½ç« </li>
                    <li>æ‰€æœ‰å±¬æ€§ç¸½å’Œé”åˆ° 200 é»ï¼Œä¸”æ¯é …å±¬æ€§è‡³å°‘ 50 é»</li>
                    <li>å®Œæˆ 3 è¼ªå®Œæ•´æ£‹ç›¤æ—…ç¨‹ï¼ˆ96æ ¼ï¼‰</li>
                </ul>
                
                <h3>ğŸ’¡ äººæ¬Šä¸»é¡Œ</h3>
                <p>éŠæˆ²æ¶µè“‹è¨€è«–è‡ªç”±ã€å¹³ç­‰æ¬Šåˆ©ã€æ•™è‚²æ¬Šã€å·¥ä½œæ¬Šã€ç’°å¢ƒæ¬Šç­‰å„ç¨®äººæ¬Šè­°é¡Œã€‚</p>
            </div>
        </div>
    </div>

    <script>
        // éŠæˆ²ç‹€æ…‹ - é™ä½åˆå§‹å±¬æ€§
        let gameState = {
            currentPlayer: 1,
            players: {
                1: { position: 0, influence: 30, resources: 20, reputation: 25, achievements: [], totalMoves: 0 },
                2: { position: 0, influence: 25, resources: 25, reputation: 20, achievements: [], totalMoves: 0 }
            },
            gameStarted: false,
            currentScenario: null
        };

        // äººæ¬Šæƒ…å¢ƒè³‡æ–™åº« - å¢åŠ æ›´å…·æŒ‘æˆ°æ€§çš„é¸æ“‡
        const scenarios = [
            {
                title: "è¨€è«–è‡ªç”±æŒ‘æˆ°",
                description: "ä¸€ä½è¨˜è€…å› å ±å°æ”¿åºœè²ªè…è¢«å¨è„…ï¼Œä½ æœƒå¦‚ä½•æ”¯æŒä»–ï¼Ÿ",
                choices: [
                    { text: "å…¬é–‹è²æ´ä¸¦çµ„ç¹”æŠ—è­°", influence: 20, reputation: 15, resources: -15 },
                    { text: "ç§ä¸‹å”åŠ©ä¸¦æä¾›æ³•å¾‹æ”¯æ´", influence: 12, reputation: 10, resources: -8 },
                    { text: "ä¿æŒæ²‰é»˜ä»¥ä¿è­·è‡ªèº«å®‰å…¨", influence: -8, reputation: -15, resources: 0 }
                ]
            },
            {
                title: "æ•™è‚²å¹³ç­‰å±æ©Ÿ",
                description: "åé åœ°å€å…’ç«¥é¢è‡¨æ•™è‚²è³‡æºåš´é‡ä¸è¶³ï¼Œæ”¿åºœé ç®—é­åˆ°å‰Šæ¸›ï¼Œä½ æ±ºå®šæ¡å–ä»€éº¼è¡Œå‹•ï¼Ÿ",
                choices: [
                    { text: "ç™¼èµ·å¤§è¦æ¨¡å‹Ÿè³‡å»ºå­¸æ ¡", influence: 18, reputation: 12, resources: -20 },
                    { text: "éŠèªªåœ‹æœƒæ¢å¾©æ•™è‚²é ç®—", influence: 15, reputation: 20, resources: -12 },
                    { text: "çµ„ç¹”çŸ­æœŸå¿—å·¥æ•™å­¸æ´»å‹•", influence: 8, reputation: 8, resources: -5 }
                ]
            },
            {
                title: "å‹å·¥æ¬Šç›Šè¡çª",
                description: "è·¨åœ‹ä¼æ¥­å‰å‰Šç•¶åœ°å‹å·¥ï¼Œå·¥äººç½·å·¥é­åˆ°æš´åŠ›é®å£“ï¼Œåœ‹éš›è¼¿è«–é—œæ³¨ï¼Œä½ æœƒå¦‚ä½•ä»‹å…¥ï¼Ÿ",
                choices: [
                    { text: "çµ„ç¹”åœ‹éš›è¯åˆæŠµåˆ¶è¡Œå‹•", influence: 25, reputation: 10, resources: -18 },
                    { text: "é€éæ³•å¾‹é€”å¾‘æèµ·åœ‹éš›è¨´è¨Ÿ", influence: 15, reputation: 25, resources: -15 },
                    { text: "é€²è¡Œåª’é«”æ›å…‰èˆ‡äººé“æ•‘æ´", influence: 18, reputation: 15, resources: -10 }
                ]
            },
            {
                title: "ç’°å¢ƒæ­£ç¾©å±æ©Ÿ",
                description: "å¤§å‹åŒ–å·¥å» é•·æœŸæ±¡æŸ“å°è‡´ç™Œç—‡æ‘å‡ºç¾ï¼Œæ”¿åºœèˆ‡ä¼æ¥­å‹¾çµæ©è“‹çœŸç›¸ï¼Œä½ é¢è‡¨ç”Ÿå‘½å¨è„…ï¼Œå¦‚ä½•è¡Œå‹•ï¼Ÿ",
                choices: [
                    { text: "å†’éšªæ”¶é›†è­‰æ“šä¸¦åœ‹éš›æ›å…‰", influence: 30, reputation: 20, resources: -25 },
                    { text: "å°‹æ±‚åœ‹éš›ç’°ä¿çµ„ç¹”æ”¯æ´", influence: 20, reputation: 25, resources: -15 },
                    { text: "å…ˆå”åŠ©å±…æ°‘æ¬é·ä¿è­·ç”Ÿå‘½", influence: 8, reputation: 12, resources: -20 }
                ]
            },
            {
                title: "æ€§åˆ¥å¹³ç­‰æŒ‘æˆ°",
                description: "å‚³çµ±ç¤¾æœƒä¸­å¥³æ€§é­å—ç³»çµ±æ€§æ­§è¦–ï¼Œåå°å‹¢åŠ›å¼·å¤§ï¼Œæ”¹é©é¢è‡¨é‡é‡é˜»ç¤™ï¼Œä½ çš„ç­–ç•¥æ˜¯ï¼Ÿ",
                choices: [
                    { text: "ç™¼èµ·å…¨åœ‹æ€§å©¦å¥³æ¬Šåˆ©é‹å‹•", influence: 22, reputation: 18, resources: -18 },
                    { text: "æ¨å‹•ç«‹æ³•ä¿è­·ä¸¦å»ºç«‹æ”¯æ´ç¶²çµ¡", influence: 18, reputation: 22, resources: -12 },
                    { text: "å¾æ•™è‚²è‘—æ‰‹é€æ­¥æ”¹è®Šè§€å¿µ", influence: 12, reputation: 15, resources: -8 }
                ]
            },
            {
                title: "é›£æ°‘äººé“å±æ©Ÿ",
                description: "æˆ°çˆ­å°è‡´å¤§è¦æ¨¡é›£æ°‘æ½®ï¼Œæ”¿åºœæ‹’çµ•æ¥ç´ï¼Œæ°‘çœ¾ææ‡¼æ’å¤–ï¼Œåœ‹éš›å£“åŠ›å·¨å¤§ï¼Œä½ å¦‚ä½•æ‡‰å°ï¼Ÿ",
                choices: [
                    { text: "ç›´æ¥é•æ³•æä¾›åº‡è­·ä¸¦æ‰¿æ“”å¾Œæœ", influence: 25, reputation: 20, resources: -25 },
                    { text: "çµ„ç¹”å¤§è¦æ¨¡éŠèªªæ”¹è®Šæ”¿ç­–", influence: 20, reputation: 25, resources: -20 },
                    { text: "å»ºç«‹æ°‘é–“æ•‘æ´ç¶²çµ¡", influence: 15, reputation: 15, resources: -15 }
                ]
            },
            {
                title: "æ•¸ä½éš±ç§æ¬Šçˆ­è­°",
                description: "æ”¿åºœæ¨è¡Œå¤§è¦æ¨¡ç›£æ§ç³»çµ±ï¼Œä»¥åæç‚ºåä¾µçŠ¯å…¬æ°‘éš±ç§ï¼Œç§‘æŠ€å·¨é ­é…åˆæ”¿ç­–ï¼Œä½ å¦‚ä½•æè¡›éš±ç§æ¬Šï¼Ÿ",
                choices: [
                    { text: "ç™¼èµ·æ•¸ä½æŠµæŠ—èˆ‡ç¶²è·¯è¡Œå‹•ä¸»ç¾©", influence: 20, reputation: 12, resources: -15 },
                    { text: "æèµ·æ†²æ³•è¨´è¨ŸæŒ‘æˆ°ç›£æ§æ³•æ¡ˆ", influence: 15, reputation: 20, resources: -18 },
                    { text: "æ•™è‚²æ°‘çœ¾ä¿è­·å€‹äººæ•¸æ“š", influence: 10, reputation: 15, resources: -8 }
                ]
            },
            {
                title: "åŸä½æ°‘æ¬Šåˆ©ä¿è­·",
                description: "é–‹ç™¼å•†è¦åœ¨è–åœ°é–‹æ¡ç¤¦ç‰©ï¼ŒåŸä½æ°‘æ—æŠ—è­°é­åˆ°å¿½è¦–ï¼Œå‚³çµ±æ–‡åŒ–é¢è‡¨æ»…çµ•å±æ©Ÿï¼Œä½ æœƒæ€éº¼åšï¼Ÿ",
                choices: [
                    { text: "çµ„ç¹”åœ‹éš›åŸä½æ°‘æ¬Šåˆ©è¯ç›Ÿ", influence: 22, reputation: 18, resources: -20 },
                    { text: "é€éè¯åˆåœ‹æ©Ÿåˆ¶æ–½å£“", influence: 18, reputation: 22, resources: -15 },
                    { text: "å”åŠ©ä¿å­˜æ–‡åŒ–ä¸¦è¨˜éŒ„æ­·å²", influence: 12, reputation: 12, resources: -10 }
                ]
            }
        ];

        // æˆå°±ç³»çµ± - æ›´é«˜é›£åº¦è¦æ±‚
        const achievements = [
            { name: "è¨€è«–è‡ªç”±å®ˆè­·è€…", condition: (p) => p.influence >= 85, badge: "ğŸ¤" },
            { name: "å¹³ç­‰æ¬Šåˆ©å€¡å°è€…", condition: (p) => p.reputation >= 80, badge: "âš–ï¸" },
            { name: "è³‡æºæ•´åˆå°ˆå®¶", condition: (p) => p.resources >= 70, badge: "ğŸ’°" },
            { name: "ç¤¾å€é ˜å°è€…", condition: (p) => (p.influence + p.reputation) >= 140, badge: "ğŸ‘¥" },
            { name: "äººæ¬Šæˆ°å£«", condition: (p) => (p.influence >= 100 && p.reputation >= 70 && p.resources >= 60), badge: "ğŸ›¡ï¸" },
            { name: "åœ‹éš›å€¡å°è€…", condition: (p) => p.influence >= 90 && p.reputation >= 90, badge: "ğŸŒ" },
            { name: "å±æ©Ÿè™•ç†å°ˆå®¶", condition: (p) => p.resources >= 80 && p.reputation >= 60, badge: "ğŸš¨" },
            { name: "å…¨èƒ½äººæ¬Šè¡›å£«", condition: (p) => p.influence >= 80 && p.reputation >= 80 && p.resources >= 80, badge: "ğŸ‘‘" }
        ];

        // é é¢è¼‰å…¥æ™‚åˆå§‹åŒ–éŠæˆ²
        window.onload = function() {
            initializeBoard();
            updatePlayerStats();
            updateCurrentTurn();
        };

        // åˆå§‹åŒ–éŠæˆ²æ£‹ç›¤
        function initializeBoard() {
            const board = document.getElementById('gameBoard');
            board.innerHTML = ''; // æ¸…ç©ºæ£‹ç›¤
            
            for (let i = 0; i < 32; i++) { // æ¸›å°‘åˆ°32æ ¼è®“éŠæˆ²æ›´ç·Šæ¹Š
                const cell = document.createElement('div');
                cell.className = 'board-cell';
                cell.id = `cell-${i}`;
                
                if (i === 0) {
                    cell.classList.add('start');
                    cell.innerHTML = '<div>ğŸ </div><div>èµ·é»</div>';
                } else if (i % 8 === 7) {
                    cell.classList.add('goal');
                    cell.innerHTML = '<div>ğŸ¯</div><div>é‡Œç¨‹ç¢‘</div>';
                } else if (i % 3 === 0) {
                    cell.classList.add('challenge');
                    cell.innerHTML = '<div>âš¡</div><div>æŒ‘æˆ°</div>';
                } else if (i % 5 === 0) {
                    cell.classList.add('opportunity');
                    cell.innerHTML = '<div>ğŸ’¡</div><div>æ©Ÿæœƒ</div>';
                } else {
                    cell.innerHTML = '<div>ğŸ“</div><div>æ™®é€š</div>';
                }
                
                board.appendChild(cell);
            }
            
            // æ”¾ç½®ç©å®¶æ£‹å­
            updatePlayerPositions();
        }

        // æ›´æ–°ç©å®¶ä½ç½®
        function updatePlayerPositions() {
            // æ¸…é™¤æ‰€æœ‰æ£‹å­
            document.querySelectorAll('.player-piece').forEach(piece => piece.remove());
            
            // é‡æ–°æ”¾ç½®æ£‹å­
            Object.keys(gameState.players).forEach(playerId => {
                const position = gameState.players[playerId].position;
                const cell = document.getElementById(`cell-${position}`);
                if (cell) {
                    const piece = document.createElement('div');
                    piece.className = `player-piece player${playerId}`;
                    cell.appendChild(piece);
                }
            });
        }

        // æ›´æ–°ç•¶å‰å›åˆé¡¯ç¤º
        function updateCurrentTurn() {
            const turnDiv = document.getElementById('currentTurn');
            const playerName = gameState.currentPlayer === 1 ? 'è¨˜è€…' : 'å¾‹å¸«';
            turnDiv.textContent = `ç›®å‰è¼ªåˆ°ï¼šç©å®¶${gameState.currentPlayer} (${playerName})`;
            
            // æ›´æ–°ç©å®¶å¡ç‰‡é«˜äº®
            document.querySelectorAll('.player-card').forEach(card => {
                card.classList.remove('active');
            });
            document.getElementById(`player${gameState.currentPlayer}Card`).classList.add('active');
        }

        // æ“²éª°å­
        function rollDice() {
            const dice = Math.floor(Math.random() * 6) + 1;
            const player = gameState.players[gameState.currentPlayer];
            
            // ç§»å‹•ç©å®¶
            player.position = (player.position + dice) % 32;
            updatePlayerPositions();
            
            // è¨˜éŒ„æ—¥èªŒ
            addToLog(`ç©å®¶${gameState.currentPlayer} æ“²å‡º ${dice} é»ï¼Œç§»å‹•åˆ°ä½ç½® ${player.position}`);
            
            // è§¸ç™¼äº‹ä»¶
            const cell = document.getElementById(`cell-${player.position}`);
            const cellClasses = cell.classList;
            
            if (cellClasses.contains('challenge') || cellClasses.contains('opportunity')) {
                setTimeout(() => showScenario(), 500);
            } else if (cellClasses.contains('goal')) {
                setTimeout(() => showMilestone(), 500);
            } else {
                // æ™®é€šæ ¼å­ï¼Œçå‹µæ¸›å°‘ä¸¦å¢åŠ éš¨æ©Ÿäº‹ä»¶
                const randomEvent = Math.random();
                if (randomEvent < 0.3) {
                    // 30% æ©Ÿç‡é‡åˆ°å°æŒ«æŠ˜
                    const penalty = Math.floor(Math.random() * 3) + 1;
                    player.resources = Math.max(0, player.resources - penalty);
                    addToLog(`ç©å®¶${gameState.currentPlayer} é‡åˆ°å°æŒ«æŠ˜ï¼Œå¤±å» ${penalty} é»è³‡æº`);
                } else {
                    // 70% æ©Ÿç‡ç²å¾—å°çå‹µ
                    player.resources += 1;
                    addToLog(`ç©å®¶${gameState.currentPlayer} ç²å¾— 1 é»è³‡æº`);
                }
                updatePlayerStats();
                switchPlayer();
            }
            
            gameState.gameStarted = true;
        }

        // é¡¯ç¤ºæƒ…å¢ƒ
        function showScenario() {
            const scenario = scenarios[Math.floor(Math.random() * scenarios.length)];
            const eventCard = document.getElementById('eventCard');
            const eventTitle = document.getElementById('eventTitle');
            const eventDescription = document.getElementById('eventDescription');
            const choiceButtons = document.getElementById('choiceButtons');
            
            eventCard.className = 'event-card active';
            eventTitle.textContent = `ğŸ¯ ${scenario.title}`;
            eventDescription.textContent = scenario.description;
            
            // ç”Ÿæˆé¸æ“‡æŒ‰éˆ•
            choiceButtons.innerHTML = '';
            scenario.choices.forEach((choice, index) => {
                const button = document.createElement('button');
                button.className = 'choice-btn';
                button.textContent = choice.text;
                button.onclick = () => makeChoice(index);
                choiceButtons.appendChild(button);
            });
            
            choiceButtons.style.display = 'flex';
            
            // å„²å­˜ç•¶å‰æƒ…å¢ƒ
            gameState.currentScenario = scenario;
        }

        // é¡¯ç¤ºé‡Œç¨‹ç¢‘ - æ¸›å°‘çå‹µ
        function showMilestone() {
            const player = gameState.players[gameState.currentPlayer];
            const bonus = {
                influence: 8,
                reputation: 6,
                resources: 4
            };
            
            player.influence += bonus.influence;
            player.reputation += bonus.reputation;
            player.resources += bonus.resources;
            
            const eventCard = document.getElementById('eventCard');
            const eventTitle = document.getElementById('eventTitle');
            const eventDescription = document.getElementById('eventDescription');
            const choiceButtons = document.getElementById('choiceButtons');
            
            eventCard.className = 'event-card active';
            eventTitle.textContent = 'ğŸ‰ é‡Œç¨‹ç¢‘é”æˆï¼';
            eventDescription.textContent = `æ­å–œï¼ä½ é”æˆäº†ä¸€å€‹é‡Œç¨‹ç¢‘ï¼ç²å¾—å½±éŸ¿åŠ›+${bonus.influence}ã€è²æœ›+${bonus.reputation}ã€è³‡æº+${bonus.resources}`;
            choiceButtons.style.display = 'none';
            
            addToLog(`ç©å®¶${gameState.currentPlayer} é”æˆé‡Œç¨‹ç¢‘ï¼Œç²å¾—è±åšçå‹µï¼`);
            updatePlayerStats();
            checkAchievements();
            checkWinCondition();
            
            // 3ç§’å¾Œè‡ªå‹•åˆ‡æ›ç©å®¶
            setTimeout(() => {
                eventCard.className = 'event-card';
                switchPlayer();
            }, 3000);
        }

        // åšå‡ºé¸æ“‡
        function makeChoice(choiceIndex) {
            const scenario = gameState.currentScenario;
            const player = gameState.players[gameState.currentPlayer];
            const choice = scenario.choices[choiceIndex];
            
            // æ‡‰ç”¨é¸æ“‡çµæœ
            player.influence = Math.max(0, player.influence + choice.influence);
            player.reputation = Math.max(0, player.reputation + choice.reputation);
            player.resources = Math.max(0, player.resources + choice.resources);
            
            // éš±è—äº‹ä»¶å¡
            document.getElementById('eventCard').className = 'event-card';
            
            // è¨˜éŒ„æ—¥èªŒ
            addToLog(`ç©å®¶${gameState.currentPlayer} é¸æ“‡ï¼š${choice.text}`);
            
            // æ›´æ–°é¡¯ç¤º
            updatePlayerStats();
            checkAchievements();
            checkWinCondition();
            
            // åˆ‡æ›ç©å®¶
            switchPlayer();
        }

        // åˆ‡æ›ç©å®¶
        function switchPlayer() {
            gameState.currentPlayer = gameState.currentPlayer === 1 ? 2 : 1;
            updateCurrentTurn();
        }

        // æª¢æŸ¥æˆå°±
        function checkAchievements() {
            const player = gameState.players[gameState.currentPlayer];
            
            achievements.forEach(achievement => {
                if (!player.achievements.includes(achievement.name) && achievement.condition(player)) {
                    player.achievements.push(achievement.name);
                    addToLog(`ğŸ† ç©å®¶${gameState.currentPlayer} ç²å¾—æˆå°±ï¼š${achievement.name}`);
                    
                    // é¡¯ç¤ºæˆå°±å¾½ç« 
                    const achievementDiv = document.getElementById(`player${gameState.currentPlayer}-achievements`);
                    const badge = document.createElement('span');
                    badge.className = 'achievement-badge';
                    badge.textContent = `${achievement.badge} ${achievement.name}`;
                    achievementDiv.appendChild(badge);
                }
            });
        }

        // æª¢æŸ¥ç²å‹æ¢ä»¶ - æé«˜é›£åº¦
        function checkWinCondition() {
            const player = gameState.players[gameState.currentPlayer];
            
            if (player.influence >= 120) {
                showWinModal(`ç©å®¶${gameState.currentPlayer} æ†‘è—‰å“è¶Šçš„å½±éŸ¿åŠ›ï¼ˆ120é»ï¼‰ç²å‹ï¼æˆç‚ºçœŸæ­£çš„äººæ¬Šé ˜è¢–ï¼`);
            } else if (player.achievements.length >= 5) {
                showWinModal(`ç©å®¶${gameState.currentPlayer} æ†‘è—‰çœ¾å¤šæˆå°±ï¼ˆ5å€‹å¾½ç« ï¼‰ç²å‹ï¼ä½ æ˜¯å…¨èƒ½çš„äººæ¬Šè¡›å£«ï¼`);
            } else if ((player.influence + player.reputation + player.resources) >= 200 && 
                       player.influence >= 50 && player.reputation >= 50 && player.resources >= 50) {
                showWinModal(`ç©å®¶${gameState.currentPlayer} æ†‘è—‰å…¨é¢å“è¶Šç™¼å±•ç²å‹ï¼ä¸‰é …å±¬æ€§å‡è¶…é50ä¸”ç¸½å’Œé”200ï¼`);
            } else if (Math.floor(player.position / 32) >= 3) { // å®Œæˆ3è¼ª
                showWinModal(`ç©å®¶${gameState.currentPlayer} å®Œæˆ3è¼ªäººæ¬Šå®ˆè­·é•·å¾ç²å‹ï¼å …æŒä¸æ‡ˆçš„ç²¾ç¥ä»¤äººæ•¬ä½©ï¼`);
            }
        }

        // é¡¯ç¤ºç²å‹æ¨¡æ…‹çª—
        function showWinModal(message) {
            const modal = document.createElement('div');
            modal.className = 'modal';
            modal.style.display = 'block';
            modal.innerHTML = `
                <div class="modal-content">
                    <h2>ğŸ‰ éŠæˆ²çµæŸï¼</h2>
                    <p style="font-size: 1.2em; margin: 20px 0;">${message}</p>
                    <button class="btn btn-primary" onclick="resetGame(); this.parentElement.parentElement.remove();">é‡æ–°é–‹å§‹</button>
                </div>
            `;
            document.body.appendChild(modal);
        }

        // æ›´æ–°ç©å®¶çµ±è¨ˆ
        function updatePlayerStats() {
            Object.keys(gameState.players).forEach(playerId => {
                const player = gameState.players[playerId];
                document.getElementById(`player${playerId}-influence`).textContent = player.influence;
                document.getElementById(`player${playerId}-resources`).textContent = player.resources;
                document.getElementById(`player${playerId}-reputation`).textContent = player.reputation;
            });
        }

        // æ·»åŠ åˆ°éŠæˆ²æ—¥èªŒ
        function addToLog(message) {
            const log = document.getElementById('gameLog');
            const entry = document.createElement('div');
            entry.className = 'log-entry';
            entry.textContent = message;
            log.appendChild(entry);
            log.scrollTop = log.scrollHeight;
        }

        // é¡¯ç¤ºè¦å‰‡
        function showRules() {
            document.getElementById('rulesModal').style.display = 'block';
        }

        // é—œé–‰æ¨¡æ…‹çª—
        function closeModal() {
            document.getElementById('rulesModal').style.display = 'none';
        }

        // é‡ç½®éŠæˆ² - æ›´æ–°åˆå§‹å€¼
        function resetGame() {
            gameState = {
                currentPlayer: 1,
                players: {
                    1: { position: 0, influence: 30, resources: 20, reputation: 25, achievements: [], totalMoves: 0 },
                    2: { position: 0, influence: 25, resources: 25, reputation: 20, achievements: [], totalMoves: 0 }
                },
                gameStarted: false,
                currentScenario: null
            };
            
            // æ¸…ç©ºæˆå°±é¡¯ç¤º
            document.getElementById('player1-achievements').innerHTML = '';
            document.getElementById('player2-achievements').innerHTML = '';
            
            // é‡ç½®äº‹ä»¶å¡
            const eventCard = document.getElementById('eventCard');
            eventCard.className = 'event-card';
            document.getElementById('eventTitle').textContent = 'ğŸ¯ æº–å‚™é–‹å§‹';
            document.getElementById('eventDescription').textContent = 'é»æ“Šæ“²éª°å­é–‹å§‹ä½ çš„äººæ¬Šå®ˆè­·ä¹‹æ—…ï¼';
            document.getElementById('choiceButtons').style.display = 'none';
            
            // æ¸…ç©ºéŠæˆ²æ—¥èªŒ
            const gameLog = document.getElementById('gameLog');
            gameLog.innerHTML = '<div class="log-entry">ğŸ® éŠæˆ²é‡æ–°é–‹å§‹ï¼æ­¡è¿ä¾†åˆ°äººæ¬Šå®ˆè­·è€…çš„ä¸–ç•Œ</div>';
            
            // é‡æ–°åˆå§‹åŒ–æ£‹ç›¤
            initializeBoard();
            updatePlayerStats();
            updateCurrentTurn();
            
            // ç§»é™¤ä»»ä½•ç¾æœ‰çš„ç²å‹æ¨¡æ…‹çª—
            document.querySelectorAll('.modal').forEach(modal => {
                if (modal.id !== 'rulesModal') {
                    modal.remove();
                }
            });
        }

        // é»æ“Šæ¨¡æ…‹çª—å¤–éƒ¨é—œé–‰
        window.onclick = function(event) {
            const modal = document.getElementById('rulesModal');
            if (event.target === modal) {
                modal.style.display = 'none';
            }
        }

        // éµç›¤æ§åˆ¶
        document.addEventListener('keydown', function(event) {
            switch(event.key) {
                case ' ':
                case 'Enter':
                    event.preventDefault();
                    if (!document.querySelector('.event-card.active')) {
                        rollDice();
                    }
                    break;
                case 'r':
                case 'R':
                    if (event.ctrlKey) {
                        event.preventDefault();
                        resetGame();
                    }
                    break;
                case '1':
                    if (document.querySelector('.choice-btn')) {
                        document.querySelector('.choice-btn').click();
                    }
                    break;
                case '2':
                    const secondChoice = document.querySelectorAll('.choice-btn')[1];
                    if (secondChoice) secondChoice.click();
                    break;
                case '3':
                    const thirdChoice = document.querySelectorAll('.choice-btn')[2];
                    if (thirdChoice) thirdChoice.click();
                    break;
            }
        });

        // æ·»åŠ éŠæˆ²æç¤º
        function showGameTips() {
            addToLog('ğŸ’¡ éŠæˆ²æç¤ºï¼šä½¿ç”¨ç©ºç™½éµæˆ–Enterå¿«é€Ÿæ“²éª°å­ï¼Œæ•¸å­—éµ1-3å¿«é€Ÿé¸æ“‡é¸é …');
        }

        // åœ¨éŠæˆ²é–‹å§‹æ™‚é¡¯ç¤ºæç¤º
        setTimeout(showGameTips, 2000);
    </script>
</body>
</html>
